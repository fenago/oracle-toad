000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID.  DB2PGM2.
000300*
000400*	THIS IS	THE SKELETON TO	WORKSHOP VII, EMBEDDED SQL PROGRAM.
000500*
000600 ENVIRONMENT DIVISION.
000700*
000800 DATA DIVISION.
000900*
001000	   EJECT
001100 WORKING-STORAGE SECTION.
001200*
001300 77  FILLER    PIC X(15) VALUE 'WORKING STORAGE'.
001400*
001401*
001402*
001403*
001500 01  PRESIDENT-REC.
001600	   10 PR-PRES-NAME	      PIC X(20)	 VALUE
001700	      'KLINGER,	MAXWELL	   '.
001800	   10 PR-BIRTH-YEAR	      PIC 9(04)	 VALUE	1920.
001900	   10 PR-YEARS-SERV	      PIC 9(02)	 VALUE	4.
002000	   10 PR-DEATH-AGE	      PIC 9(02)	 VALUE	0.
002100	   10 PR-PARTY		      PIC X(20)	 VALUE
002200	       'REPUBLICAN'.
002300	   10 PR-STATE-BORN	      PIC X(20)	 VALUE
002400	       'OHIO'.
002500	   10 FILLER		      PIC X(11)	 VALUE	SPACES.
002600 01  ELECTION-REC.
002700	   10 ER-ELECT-YEAR	      PIC 9(04)	 VALUE	1948.
002800	   10 ER-CANDIDATE	      PIC X(20)	 VALUE
002900	       'KLINGER, MAXWELL'.
003000	   10 ER-VOTES		      PIC 9(03)	 VALUE	527.
003100	   10 ER-WIN-LOSE	      PIC X(01)	 VALUE	'W'.
003200	   10 FILLER		      PIC X(51)	 VALUE	SPACES.
003300*
003400*
003410*
003420	   EXEC	SQL
003430	     INCLUDE SQLCA
003440	   END-EXEC.
003500*
004000	   EXEC	SQL
004100	     INCLUDE PRES
004200	   END-EXEC.
004300*
004400	   EXEC	SQL
004500	     INCLUDE ELECT
004600	   END-EXEC.
004700*
006400	   EJECT
006500 PROCEDURE DIVISION.
006600*
006601 INIT-PROGRAM.
006602*
006700	   EXEC	SQL
006800	      DECLARE ELECTCUR CURSOR FOR
006810	      SELECT VOTES,WINNER_LOSER_INDIC
006820	      FROM ELECTION
006821	      FOR UPDATE OF WINNER_LOSER_INDIC
006830	   END-EXEC.
006840
006841	   EXEC	SQL
006842	      OPEN ELECTCUR
006846	   END-EXEC.
006850*
006900 INIT-PROGRAM-EXIT.  EXIT.
007000*
009200 BEGIN-PROGRAM.
009300*
009400*	   PERFORM C100-INSERT-PRESIDENT
009500*	      THRU C100-INSERT-PRESIDENT-EXIT.
009600*
009700*	   PERFORM D100-INSERT-ELECTION
009800*	      THRU D100-INSERT-ELECTION-EXIT.
009900*
010000*	   PERFORM R100-CHANGE-WIN-LOSE
010100*	      THRU R100-CHANGE-WIN-LOSE-EXIT
010200*	      UNTIL SQLCODE = 100 OR
010210*	      SQLCODE <	0.
010220*
010230*
010300*	   PERFORM S100-CHANGE-DEMOCRAT
010400*	      THRU S100-CHANGE-DEMOCRAT-EXIT.
010500*
010600	   PERFORM T100-DELETE-HOSPERS
010700	      THRU T100-DELETE-HOSPERS-EXIT.
010810*
010900	   GOBACK.
011000*
011200*
011300*
011400*	   THIS	SECTION	WILL UPDATE THE	PRESIDENT TABLE.
011500*
011600*
011700 C100-INSERT-PRESIDENT.
011800
011870
011900*	   EXEC	SQL
011910*	      INSERT INTO PRESIDENT
011911*	      (PRES_NAME,BIRTH_YR,YRS_SERV,PARTY,STATE_BORN)
011920*	      VALUES('MAXWELL KLINGER',:BIRTH-YR,:YRS-SERV,:PARTY,
011921*		     :STATE-BORN)
011930*	   END-EXEC.
011940*
012000*
013900 C100-INSERT-PRESIDENT-EXIT.
014000	   EXIT.
014100*
014200*
014300*	   THIS	SECTION	WILL UPDATE THE	ELECTION TABLE.
014400*
014500*
014600 D100-INSERT-ELECTION.
014700*
014820*	   EXEC	SQL
014830*	      UPDATE ELECTION
014840*	      SET PARTY	= 'DEMOCRAT'
014850*	      WHERE PARTY LIKE '%ULTRA%'
014870*	   END-EXEC.
014880
016900 D100-INSERT-ELECTION-EXIT.
017000	   EXIT.
017100*
017200*
017300*	   THIS	SECTION	WILL MODIFY THE	COLUMN
017400*	   WINNER-LOSER-INDIC.
017500*
017600*
017700 R100-CHANGE-WIN-LOSE.
017800
017810*	   DISPLAY 'R100 ENTER ',SQLCODE
017900	   EXEC	SQL
017910	     FETCH ELECTCUR
017920	     INTO :VOTES,:WINNER-LOSER-INDIC
017930	   END-EXEC.
017931*	   DISPLAY 'R100 FETCH ',SQLCODE
017940
017950	   IF SQLCODE =	0
017960	     EVALUATE TRUE ALSO	TRUE
017970	       WHEN VOTES >= 0 ALSO VOTES < 68
017980		 MOVE 'S' TO WINNER-LOSER-INDIC
017981	       WHEN VOTES > 67 ALSO VOTES < 202
017982		 MOVE 'W' TO WINNER-LOSER-INDIC
017983	       WHEN VOTES > 201	ALSO VOTES < 347
017984		 MOVE 'C' TO WINNER-LOSER-INDIC
017985	       WHEN VOTES > 346	ALSO VOTES < 471
017986		 MOVE 'M' TO WINNER-LOSER-INDIC
017987	       WHEN VOTES > 470	ALSO VOTES < 539
017988		 MOVE 'L' TO WINNER-LOSER-INDIC
017991	     END-EVALUATE
017992*	   DISPLAY 'WIN-LOSE = ',WINNER-LOSER-INDIC
018010
018020	     EXEC SQL
018030	       UPDATE ELECTION
018040	       SET WINNER_LOSER_INDIC =	:WINNER-LOSER-INDIC
018041	       WHERE CURRENT OF	ELECTCUR
018050	     END-EXEC
018051	     END-IF.
018052*	   DISPLAY 'UPDATE CODE	',SQLCODE.
018060
018100*
020000 R100-CHANGE-WIN-LOSE-EXIT.
020100	   EXIT.
020200*
020300*
020400*	   THIS	SECTION	WILL CHANGE 'DEMOCRAT'
020500*	   TO 'DEMOCRATIC'.
020600*
020700*
020800 S100-CHANGE-DEMOCRAT.
020900*
021000*
021100*
023100 S100-CHANGE-DEMOCRAT-EXIT.
023200	   EXIT.
023300*
023400*
023500*	   THIS	SECTION	WILL REMOVE J HOSPERS
023600*	   AS A	CANDIDATE.
023700*
023800*
023900 T100-DELETE-HOSPERS.
024000*
024001	   EXEC	SQL
024002	     DELETE FROM ELECTION
024003	     WHERE CANDIDATE LIKE '%HOSPERS%'
024004	   END-EXEC.
024005*
024200*
026400 T100-DELETE-HOSPERS-EXIT.
026500	   EXIT.
026600*
026900**************************** END OF PROGRAM **********************

